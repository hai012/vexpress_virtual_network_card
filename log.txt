[root@vexpress ]$ ./install_mynet.sh
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
qemu-system-arm: Slirp: Failed to send packet, ret: -1
mynet_driver: loading out-of-tree module taints kernel.
drm-clcd-pl111 10020000.clcd: DVI muxed to daughterboard 1 (core tile) CLCD
drm-clcd-pl111 10020000.clcd: initializing Versatile Express PL111


mynet_open:hw_init
QEMU:set IRQ flag,reg=0x00000000
QEMU:set flag,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ mask,reg=0x00000000
QEMU:set IRQ mask,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ flag,reg=0x00000000
QEMU:set flag,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ mask,reg=0x00000000
QEMU:set IRQ mask,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ flag,reg=0x00000000
QEMU:set flag,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ mask,reg=0x00000000
QEMU:set IRQ mask,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ flag,reg=0x00000000
QEMU:set flag,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ mask,reg=0x00000000
QEMU:set IRQ mask,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
mynet_open:ring_init


hw_start_real_channel
QEMU:RX:START:rx_ring_node_base=0x9f040200
QEMU:RX:START:flag=0x00000003 base=0x62010042 len=0x000005e0 next=0x9f040210
QEMU:RX:tap_read:flag=0x00000003 base=0x62010042 len=0x000005e0 next=0x9f040210
QEMU:RX:START:rx_ring_node_base=0x9f040200
QEMU:RX:FRAG: 0x00 0x00 0x86 0xdd 0x33QEMU:RX:START:flag=0x00000003 base=0x62010042 len=0x000005e0 next=0x9f040210
QEMU:RX:tap_read:flag=0x00000003 base=0x62010042 len=0x000005e0 next=0x9f040210
QEMU:RX:START:rx_ring_node_base=0x9f040200
QEMU:RX:START:flag=0x00000003 base=0x62010042 len=0x000005e0 next=0x9f040210
QEMU:RX:tap_read:flag=0x00000003 base=0x62010042 len=0x000005e0 next=0x9f040210
QEMU:RX:FRAG: 0x00 0x00 0x86 0xdd 0x33 0x33 0x00 0x00 0x00 0x02 0xa6 0x28 0x24 0xef 0x20 0x76 0x86 0xdd 0x60 0x00 0x00 0x00 0x00 0x10 0x3a 0xff 0xfe 0x80 0xff 0xfe 0xef 0x20 0x76 0xff 0x02 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x85 0x00 0xa8 0x12 0x00 0x00 0x00 0x00 0x01 0x01 0xa
QEMU:RX:next ring_node:rx_ring_node_base=0x9f040210
QEMU:RX:next ring_node:flag=0x00000003 base=0x61a88042 len=0x000005e0 next=0x9f040220
QEMU:RX:tap_read:flag=0x00000003 base=0x61a88042 len=0x000005e0 next=0x9f040220
QEMU:RX:FRAG: 0x00 0x00 0x86 0xdd 0x33 0x33 0x00 0x00 0x00 0x02 0xa6 0x28 0x24 0xef 0x20 0x76 0x86 0xdd 0x60 0x00 0x00 0x00 0x00 0x10 0x3a 0xff 0xfe 0x80 0xff 0xfe 0xef 0x20 0x76 0xff 0x02 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x85 0x00 0xa8 0x12 0x00 0x00 0x00 0x00 0x01 0x01 0xa
QEMU:RX:next ring_node:rx_ring_node_base=0x9f040220
QEMU:RX:next ring_node:flag=0x00000003 base=0x61ee8042 len=0x000005e0 next=0x9f040230
QEMU:RX:START:rx_ring_node_base=0x9f040200
QEMU:RX:START:flag=0x00000002 base=0x62010042 len=0x0000004a next=0x9f040210
QEMU:RX:flag bit0== 0, belong to driver, rx ring buffer full
 0x33 0x00 0x00 0x00 0x02 0xa6 0x28 0x24 0xef 0x20 0x76 0x86 0xdd 0x60 0x00 0x00 0x00 0x00 0x10 0x3a 0xff 0xfe 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0xa4 0x28 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x85 0x00 0xa8 0x12 0x00 0x00 0x00 0x00 0x01 0x01 0xa6 0x28 0x24 0xef 0x20 0x76 0x04 0x00 0x00 0x00 0x00 0x00 0x01 0xff 0xef 0x20 0x76
QEMU:RX:next ring_node:rx_ring_node_base=0x9f040210
QEMU:RX:next ring_node:flag=0x00000002 base=0x61a88042 len=0x0000004a next=0x9f040220
QEMU:RX:flag bit0== 0, belong to driver, rx ring buffer full
QEMU:set IRQ flag,reg=0x00000000
QEMU:set flag,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000000
QEMU:set IRQ mask,reg=0x00000001
QEMU:set IRQ mask,clear tx irq,tx_irq_flag=0x00000000,tx_irq_mask=0x00000001
QEMU:RX:tap_read:flag=0x00000003 base=0x61ee8042 len=0x000005e0 next=0x9f040230
QEMU:RX:FRAG: 0x00 0x00 0x86 0xdd 0x33 0x33 0x00 0x00 0x00 0x02 0xa6 0x28 0x24 0xef 0x20 0x76 0x86 0xdd 0x60 0x00 0x00 0x00 0x00 0x10 0x3a 0xff 0xfe 0x80 0xff 0xfe 0xef 0x20 0x76 0xff 0x02 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x85 0x00 0xa8 0x12 0x00 0x00 0x00 0x00 0x01 0x01 0xa
QEMU:RX:next ring_node:rx_ring_node_base=0x9f040230
QEMU:RX:next ring_node:flag=0x00000003 base=0x61a30042 len=0x000005e0 next=0x9f040200
QEMU:RX:tap_read:flag=0x00000003 base=0x61a30042 len=0x000005e0 next=0x9f040200
QEMU:RX:FRAG: 0x00 0x00 0x86 0xdd 0x33 0x33 0x00 0x00 0x00 0x02 0xa6 0x28 0x24 0xef 0x20 0x76 0x86 0xdd 0x60 0x00 0x00 0x00 0x00 0x10 0x3a 0xff 0xfe 0x80 0xff 0xfe 0xef 0x20 0x76 0xff 0x02 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x85 0x00 0xa8 0x12 0x00 0x00 0x00 0x00 0x01 0x01 0xa
QEMU:RX:next ring_node:rx_ring_node_base=0x9f040200
QEMU:RX:next ring_node:flag=0x00000002 base=0x62010042 len=0x0000005e next=0x9f040210
QEMU:RX:flag bit0== 0, belong to driver, rx ring buffer full
MYNET:rx_hw_irq,flag:0x0003
MYNET:rx_hw_irq,prep
MYNET:rx_hw_irq,flag:0x0003
MYNET:rx_hw_irq,prep
MYNET:mynet_poll_rx:channel=4d5f2f1d
MYNET:napi_gro_receive  skb
MYNET:napi_gro_receive  skb
MYNET:napi_gro_receive  skb
MYNET:napi_gro_receive  skb
MYNET:now, there is no linear_buffer to receive
QEMU:RX:START:rx_ring_node_base=0x9f040200
QEMU:RX:START:flag=0x00000003 base=0x61fb0042 len=0x000005e0 next=0x9f040210
QEMU:RX:tap_read:flag=0x00000003 base=0x61fb0042 len=0x000005e0 next=0x9f040210
MYNET:mynet_poll_rx:channel=3c0df8ad
MYNET:now, there is no linear_buffer to receive
------------[ cut here ]------------
kernel BUG at /home/haijie.gong/disk/vexpress/driver/mynet.c:291!
Internal error: Oops - BUG: 0 [#1] SMP ARM
Modules linked in: mynet_driver(O)
CPU: 0 PID: 180 Comm: ifconfig Tainted: G           O       6.1.15 #5
Hardware name: ARM-Versatile Express
PC is at mynet_poll_rx+0x268/0x2c4 [mynet_driver]
LR is at mynet_poll_rx+0x84/0x2c4 [mynet_driver]
pc : [<7f0015d0>]    lr : [<7f0013ec>]    psr: 20000113
sp : c0801ee0  ip : 3ffffbff  fp : be7bc740
r10: 00000000  r9 : 7f0032c0  r8 : 00000000
r7 : 00000000  r6 : 00000000  r5 : 00000001  r4 : 7f0033a8
r3 : d5481d74  r2 : d5481d74  r1 : c0801e28  r0 : 0000002f
Flags: nzCv  IRQs on  FIQs on  Mode SVC_32  ISA ARM  Segment none
Control: 10c5387d  Table: 619c006a  DAC: 00000051
Register r0 information: non-paged memory
Register r1 information: 2-page vmalloc region starting at 0xc0800000 allocated at start_kernel+0x4a8/0x65c
Register r2 information: non-paged memory
Register r3 information: non-paged memory
Register r4 information: 5-page vmalloc region starting at 0x7f000000 allocated at load_module+0x988/0x1c5c
Register r5 information: non-paged memory
Register r6 information: NULL pointer
Register r7 information: NULL pointer
Register r8 information: NULL pointer
Register r9 information: 5-page vmalloc region starting at 0x7f000000 allocated at load_module+0x988/0x1c5c
Register r10 information: NULL pointer
Register r11 information: non-slab/vmalloc memory
Register r12 information: non-paged memory
Process ifconfig (pid: 180, stack limit = 0x900c826e)
Stack: (0xc0801ee0 to 0xc0802000)
1ee0: 00000000 00000000 00000040 80d4e190 7f0027ac 81a30000 80d3bdc6 00000001
1f00: 7f0033a8 00000040 c0801f5b 00000000 c0801f5c 80d03d40 be7bc740 8071fb0c
1f20: 81f41900 be7bc580 ffff9904 7f0033a8 be7bc580 ffff9904 00000128 8071fea4
1f40: 81a7a100 80d03d40 be7bc580 81a7a100 80c57580 3db65000 000033a8 c0801f5c
1f60: c0801f5c c0801f64 c0801f64 d5481d74 00000000 00000028 00000003 80d0308c
1f80: 81a7a100 00000100 c0801f98 40000003 80d03080 80101394 c081110c c0801fd0
1fa0: 00000000 80d03080 80c543c0 0000000a 80c54334 80c568c0 80c568c0 ffff9903
1fc0: 80d03d40 80a56054 00400100 809021d0 80c5687c 80112f9c 20000113 ffffffff
1fe0: cb5f1d44 00000000 81a7a100 00000000 cb5f1d08 80122d9c 80112f9c 80811884
 mynet_poll_rx [mynet_driver] from __napi_poll+0x2c/0x180
 __napi_poll from net_rx_action+0x148/0x314
 net_rx_action from __do_softirq+0x114/0x274
 __do_softirq from irq_exit+0x80/0xa8
 irq_exit from call_with_stack+0x18/0x20
 call_with_stack from __irq_svc+0x98/0xb0
Exception stack(0xcb5f1d10 to 0xcb5f1d58)
1d00:                                     00000015 00000000 9f040000 cb5b8038
1d20: 7f0034c0 7f0032c0 00000000 81065000 00000000 00000001 00000000 00000000
1d40: 3ffffbff cb5f1d60 7f001188 80112f9c 20000113 ffffffff
 __irq_svc from arm_heavy_mb+0x0/0x38
 arm_heavy_mb from mynet_open+0x178/0x1d0 [mynet_driver]
 mynet_open [mynet_driver] from __dev_open+0xe0/0x190
 __dev_open from __dev_change_flags+0x1ac/0x224
 __dev_change_flags from dev_change_flags+0x14/0x44
 dev_change_flags from devinet_ioctl+0x608/0x7d8
 devinet_ioctl from inet_ioctl+0x1bc/0x2c0
 inet_ioctl from sock_ioctl+0x474/0x54c
 sock_ioctl from sys_ioctl+0x510/0xbbc
 sys_ioctl from ret_fast_syscall+0x0/0x54
Exception stack(0xcb5f1fa8 to 0xcb5f1ff0)
1fa0:                   000b4a6f 7e8dbc30 00000003 00008914 7e8dbc30 000b4a6f
1fc0: 000b4a6f 7e8dbc30 000a1bfc 00000036 000db190 7e8dbf0b 00000003 7e8dbe0c
1fe0: 000da230 7e8dbbcc 00096841 76e22bf8
Code: eaffff7d e1a0700a e3550000 0a000000 (e7f001f2)
---[ end trace 0000000000000000 ]---
Kernel panic - not syncing: Fatal exception in interrupt
CPU2: stopping
CPU: 2 PID: 0 Comm: swapper/2 Tainted: G      D    O       6.1.15 #5
Hardware name: ARM-Versatile Express
 unwind_backtrace from show_stack+0x10/0x14
 show_stack from dump_stack_lvl+0x40/0x4c
 dump_stack_lvl from do_handle_IPI+0xf0/0x124
 do_handle_IPI from ipi_handler+0x18/0x20
 ipi_handler from handle_percpu_devid_irq+0x78/0x13c
 handle_percpu_devid_irq from generic_handle_domain_irq+0x28/0x38
 generic_handle_domain_irq from gic_handle_irq+0x74/0x88
 gic_handle_irq from generic_handle_arch_irq+0x34/0x44
 generic_handle_arch_irq from call_with_stack+0x18/0x20
 call_with_stack from __irq_svc+0x98/0xb0
Exception stack(0xc085df50 to 0xc085df98)
df40:                                     00000005 00000000 00043c31 80115f80
df60: 81076b40 80d04ed0 00000002 80d04f18 80c55f18 80d3bd8c 00000000 00000000
df80: 00000000 c085dfa0 80107350 80107354 60040013 ffffffff
 __irq_svc from arch_cpu_idle+0x38/0x3c
 arch_cpu_idle from default_idle_call+0x24/0x34
 default_idle_call from do_idle+0x1ac/0x230
 do_idle from cpu_startup_entry+0x18/0x1c
 cpu_startup_entry from secondary_start_kernel+0x11c/0x120
 secondary_start_kernel from 0x601015a0
CPU3: stopping
CPU: 3 PID: 0 Comm: swapper/3 Tainted: G      D    O       6.1.15 #5
Hardware name: ARM-Versatile Express
 unwind_backtrace from show_stack+0x10/0x14
 show_stack from dump_stack_lvl+0x40/0x4c
 dump_stack_lvl from do_handle_IPI+0xf0/0x124
 do_handle_IPI from ipi_handler+0x18/0x20
 ipi_handler from handle_percpu_devid_irq+0x78/0x13c
 handle_percpu_devid_irq from generic_handle_domain_irq+0x28/0x38
 generic_handle_domain_irq from gic_handle_irq+0x74/0x88
 gic_handle_irq from generic_handle_arch_irq+0x34/0x44
 generic_handle_arch_irq from call_with_stack+0x18/0x20
 call_with_stack from __irq_svc+0x98/0xb0
Exception stack(0xc0861f50 to 0xc0861f98)
1f40:                                     00000005 00000000 0003b819 80115f80
1f60: 81077380 80d04ed0 00000003 80d04f18 80c55f18 80d3bd8c 00000000 00000000
1f80: 00000000 c0861fa0 80107350 80107354 60000013 ffffffff
 __irq_svc from arch_cpu_idle+0x38/0x3c
 arch_cpu_idle from default_idle_call+0x24/0x34
 default_idle_call from do_idle+0x1ac/0x230
 do_idle from cpu_startup_entry+0x18/0x1c
 cpu_startup_entry from secondary_start_kernel+0x11c/0x120
 secondary_start_kernel from 0x601015a0
CPU1: stopping
CPU: 1 PID: 0 Comm: swapper/1 Tainted: G      D    O       6.1.15 #5
Hardware name: ARM-Versatile Express
 unwind_backtrace from show_stack+0x10/0x14
 show_stack from dump_stack_lvl+0x40/0x4c
 dump_stack_lvl from do_handle_IPI+0xf0/0x124
 do_handle_IPI from ipi_handler+0x18/0x20
 ipi_handler from handle_percpu_devid_irq+0x78/0x13c
 handle_percpu_devid_irq from generic_handle_domain_irq+0x28/0x38
 generic_handle_domain_irq from gic_handle_irq+0x74/0x88
 gic_handle_irq from generic_handle_arch_irq+0x34/0x44
 generic_handle_arch_irq from call_with_stack+0x18/0x20
 call_with_stack from __irq_svc+0x98/0xb0
Exception stack(0xc0859f48 to 0xc0859f90)
9f40:                   80d04edc 00000004 00000001 80d04fe0 80d6a198 00000002
9f60: 00000001 be7c6348 00000001 80d3bd8c 00000000 00000000 00000000 c0859f98
9f80: 806a3c14 8045cce8 600a0013 ffffffff
 __irq_svc from __bitmap_weight+0x0/0x68
 __bitmap_weight from ledtrig_cpu+0x80/0xf0
 ledtrig_cpu from do_idle+0x5c/0x230
 do_idle from cpu_startup_entry+0x18/0x1c
 cpu_startup_entry from secondary_start_kernel+0x11c/0x120
 secondary_start_kernel from 0x601015a0
---[ end Kernel panic - not syncing: Fatal exception in interrupt ]---
QEMU: Terminated

